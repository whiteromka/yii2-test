# Yii2 Loan Requests API

API для подачи и обработки заявок Yii2, Yii2-queue, PostgreSQL, docker compose.

Настройка, разработка и тестирование проекта заняли ~6 часов. 

---

## Развертывание проекта

###### У меня некоторые пакеты скачивались со 2-го - 3-го раза, что-то только с vpn что-то только без...
###### Возможно это проблемы сети, или роскомнадзор, или мой интернет провайдер, может такое только у меня... а может у всех...

1. Перейти в папку с проектом.
2. Выполнить сборку и поднять контейнеры:

```bash
docker compose build --no-cache
docker compose up -d
```
Зайти внутрь контейнера PHP:

```bash
docker compose exec php bash
```
Установить зависимости и применить миграции:

```bash
composer install
php yii migrate/up
```
Готово! Сервер доступен по адресу http://localhost на порту 80.

---

## Дополнительные команды
Все команды выполнять внутри контейнера PHP 
```bash
docker compose exec php bash
```

Просмотр воркеров PHP-FPM. Для теста настроено 5 воркеров при старте контейнера. Это не боевая конфигурация!
```bash
php-fpm -tt
```

Прослушка очередей. Можно запустить несколько процессов одновременно для параллельной обработки заявок.
```bash
php yii queue/listen --verbose
```

Создание тестовых заявок. Создаст 100 случайных заявок для тестирования.
```bash
php yii loan/fake 100
```

Очистка таблицы заявок. Полностью очищает таблицу loan_request
```bash
php yii loan/truncate
```
---

## API
POST /requests — подача новой заявки

GET /processor?delay=5 — обработка заявок через очередь с задержкой delay (в секундах)


